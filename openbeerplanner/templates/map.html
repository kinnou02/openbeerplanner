<!doctype html>

<html>
  
  <head>
    <title>Avec la carte !</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" />    
    <link rel="stylesheet" href="https://dl.dropboxusercontent.com/u/72446689/jquery.countdown.css" />
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />      
	<link rel="stylesheet" href="../static/css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet-src.js"></script>           
    <script src="https://dl.dropboxusercontent.com/u/72446689/jquery.countdown.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/72446689/script.js"></script>      
    
  </head>
  
  <body>
  <style>
    body {
      padding: 0;
      margin: 0;
    }
    html, body, #map {
      height: 800px;
      width: 640px;
    }
  </style>
    <header class="header">
	<a class="backtohome" href="home.html"></a>
    </header>
			<div  id="map"></div>   
			<div id="countdown"></div>
       

    <footer class="footer"></footer>
       			 	
    <footer></footer>
  
      <script>
	  var attr_osm = 'Map data &copy; <a href="http://openstreetmap.org/">OpenStreetMap</a> contributors'  
      var osm = new L.TileLayer('http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.png', {opacity: 0.7, attribution: attr_osm});
      var map = new L.Map('map').addLayer(osm).setView(new L.LatLng(48.84702,2.37705), 18);    
      var baseMaps = { "Fond de carte OSM": osm };
      var overlayMaps = {}; // ce truc ne sert à rien ...
      L.control.layers(baseMaps, overlayMaps).addTo(map);
          
    /*L.marker([48.84702,2.37705]).addTo(map);*/
    
        // ajout du marqueur Hector Malot  
        var pos_od = new L.LatLng(48.84702,2.37705);
        var content_od = "<table class='table table-striped table-bordered table-condensed'> <tr><td>Point de départ (et d'arrivée)</td></tr></table>"
		var myicon_od = L.icon({iconUrl: '../static/img/ici.png'});
        var marker_od = L.marker(pos_od, {icon: myicon_od}).bindPopup(content_od);
        marker_od.addTo(map);
          
        // ajout du marqueur sur le lieu visé  
        var pos = new L.LatLng({{amenity.coord.lat}},{{amenity.coord.lon}});  
         // var pos = new L.LatLng(48.84594,2.37182);
          
        var content = "<table class='table table-striped table-bordered table-condensed'> <tr><td>Le truc à voir</td></tr></table>"
		var myicon = L.icon({iconUrl: '../static/img/labas.png'});
        var marker = L.marker(pos, {icon: myicon}).bindPopup(content);
        marker.addTo(map);
        
        //centrer la carte pour que les deux marqueurs soient sur la carte  
        map.fitBounds([
    	[pos],
    	[pos_od]
		]);
        
        //localiser l'utilisateur 
        map.locate({setView: true, follow: true})
                .on('locationfound', function(e){
                console.log("localisation utilisateur réussie");
                    var marker = L.marker([e.latlng.lat, e.latlng.lng],{icon: L.icon({iconUrl: '../static/img/moi.png'})} ).bindPopup('Vous êtes par ici');
                    map.addLayer(marker);
                })
               .on('locationerror', function(e){
                    console.log(e);
                    alert("échec de localisation de l'utilisateur");
                });
          
        // tracer le chemin entre les points
        //
        // récupérer les points intermédiaires via navitia et les remettre à l'endroit
        var geojson = {{amenity.journey.geojson|safe}}
        //var geojsons = ['[[2.3762837213091883, 48.84680772319328], [2.3762837213091883, 48.84680772319328], [2.376692, 48.846611], [2.376638, 48.846585], [2.376032, 48.846186], [2.37597, 48.846122], [2.375873, 48.846111], [2.375799, 48.846101], [2.375721, 48.84609], [2.374362, 48.845932], [2.37418, 48.845844], [2.373679, 48.84579], [2.373698, 48.845707], [2.373867, 48.845725], [2.373955, 48.845627], [2.373227, 48.845585], [2.373242, 48.845502], [2.3734104211063154, 48.84544533495489], [2.373449, 48.84556]]', '[[2.373449, 48.84556], [2.369219, 48.852976]]', '[[2.369219, 48.852976], [2.369240920000002, 48.85282256], [2.369398, 48.852845], [2.369665, 48.853084], [2.370092, 48.853166], [2.370085, 48.853235], [2.37031, 48.853311], [2.370352, 48.853343], [2.371411, 48.854335], [2.371345, 48.85441], [2.3710767253697433, 48.85461566198231], [2.3710767253697433, 48.85461566198231]]']
 
        
        var chemin = []
        for (var i = 0; i < geojson.length; i++) 
        { 

           chemin.push(geojson[i].reverse())
        }
          //dessiner le tout
  		 var le_chemin = L.polyline(chemin, {color: 'red'}).addTo(map);      
 
    
  </script>

  </body>
</html>
