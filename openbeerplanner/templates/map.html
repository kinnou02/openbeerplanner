<!doctype html>

<html>
  
  <head>
    <title>Avec la carte !</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" />    
    <link rel="stylesheet" href="https://dl.dropboxusercontent.com/u/72446689/jquery.countdown.css" />
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />      
	<link rel="stylesheet" href="../static/css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet-src.js"></script>           
    <script src="https://dl.dropboxusercontent.com/u/72446689/jquery.countdown.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/72446689/script.js"></script>      
    
  </head>
  
  <body>
  <style>
    body {
      padding: 0;
      margin: 0;
    }
    html, body, #map {
      height: 640px;
      width: 800px;
    }
  </style>
    <header class="header">
    </header>
			<div  id="map"></div>   
			<div id="countdown"></div>
       

    <footer class="footer"></footer>
       			 	
    <footer></footer>
  
      <script>
	  var attr_osm = 'Map data &copy; <a href="http://openstreetmap.org/">OpenStreetMap</a> contributors'  
      var osm = new L.TileLayer('http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.png', {opacity: 0.7, attribution: attr_osm});
      var map = new L.Map('map').addLayer(osm).setView(new L.LatLng(48.84702,2.37705), 18);    
      var baseMaps = { "Fond de carte OSM": osm };
      var overlayMaps = {}; // ce truc ne sert à rien ...
      L.control.layers(baseMaps, overlayMaps).addTo(map);
          
    /*L.marker([48.84702,2.37705]).addTo(map);*/
    
        // ajout du marqueur Hector Malot  
        var pos_od = new L.LatLng(48.84702,2.37705);
        var content_od = "<table class='table table-striped table-bordered table-condensed'> <tr><td>Point de départ (et d'arrivée)</td></tr></table>"
		var myicon_od = L.icon({iconUrl: '../static/img/ici.png'});
        var marker_od = L.marker(pos_od, {icon: myicon_od}).bindPopup(content_od);
        marker_od.addTo(map);
          
        // ajout du marqueur sur le lieu visé  
        var pos = new L.LatLng({{amenity.coord.lat}},{{amenity.coord.lon}});  
         // var pos = new L.LatLng(48.84594,2.37182);
          
        var content = "<table class='table table-striped table-bordered table-condensed'> <tr><td>Le truc à voir</td></tr></table>"
		var myicon = L.icon({iconUrl: '../static/img/labas.png'});
        var marker = L.marker(pos, {icon: myicon}).bindPopup(content);
        marker.addTo(map);
        
        //centrer la carte pour que les deux marqueurs soient sur la carte  
        map.fitBounds([
    	[pos],
    	[pos_od]
		]);
        
        //localiser l'utilisateur 
        map.locate({setView: true, follow: true})
                .on('locationfound', function(e){
                console.log("localisation utilisateur réussie");
                    var marker = L.marker([e.latlng.lat, e.latlng.lng],{icon: L.icon({iconUrl: '../static/img/moi.png'})} ).bindPopup('Vous êtes par ici');
                    map.addLayer(marker);
                })
               .on('locationerror', function(e){
                    console.log(e);
                    alert("échec de localisation de l'utilisateur");
                });
          
        // tracer le chemin entre les points
        // 
        console.log( '{{amenity.journey.geojson[0]}}')
        L.geoJson('{{amenity.journey.geojson[0]}}', {
    style: function (feature) {
        return {color: feature.properties.color};
    },
    onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.description);
    }
}).addTo(map);
        
        // récupérer les points intermédiaires via navitia 
        	// (attention, les coordonnées sont à l'envers, il faut appliquer [].reverse() sur le couple)  
        var trace = [
        [
            2.3771293150302433,
            48.84690560664483
        ].reverse(),
        [
            2.377052,
            48.846852
        ].reverse(),
        [
            2.376759,
            48.846646
        ].reverse(),
        [
            2.376692,
            48.846611
        ].reverse(),
        [
            2.376638,
            48.846585
        ].reverse(),
        [
            2.376032,
            48.846186
        ].reverse(),
        [
            2.3757,
            48.846139
        ].reverse(),
        [
            2.374414,
            48.845988
        ].reverse(),
        [
            2.374327,
            48.845978
        ].reverse(),
        [
            2.373967,
            48.845936
        ].reverse(),
        [
            2.373875,
            48.845926
        ].reverse(),
        [
            2.373365,
            48.845867
        ].reverse(),
        [
            2.372505,
            48.845769
        ].reverse(),
        [
            2.37232,
            48.845977
        ].reverse(),
        [
            2.37218,
            48.846098
        ].reverse()

    ]        
         
       // var le_chemin = L.polyline(trace, {color: 'red'}).addTo(map);  
    
  </script>

  </body>
</html>
